<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pedidos Hamburguesas</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }
    label, select, input, button {
      display: block;
      margin-top: 10px;
      width: 100%;
    }
    .checkboxes label {
      display: inline-block;
      margin-right: 10px;
    }
    .pedido {
      border-bottom: 1px solid #ccc;
      margin: 10px 0;
      padding: 5px 0;
    }
  </style>
</head>
<body>

  <h2>üìã Hacer Pedido</h2>

  <form id="formulario">
    <label>Tama√±o:
      <select id="tamano">
        <option value="125g">125g</option>
        <option value="250g">250g</option>
      </select>
    </label>

    <label>Tipo:
      <select id="tipo">
        <option value="Tocino">Tocino</option>
        <option value="Guacamole">Guacamole</option>
        <option value="Queso">Queso</option>
        <option value="Chistorra">Chistorra</option>
        <option value="Pi√±a">Pi√±a</option>
        <option value="La T√≥xica">La T√≥xica</option>
      </select>
    </label>

    <label>
      <input type="checkbox" id="todosIngredientes" checked>
      Con todos los ingredientes
    </label>

    <div id="sinIngredientes" class="checkboxes" style="display: none;">
      <label><input type="checkbox" value="Mayonesa">Mayonesa</label>
      <label><input type="checkbox" value="Catsup">Catsup</label>
      <label><input type="checkbox" value="Mostaza">Mostaza</label>
      <label><input type="checkbox" value="Lechuga">Lechuga</label>
      <label><input type="checkbox" value="Jitomate">Jitomate</label>
      <label><input type="checkbox" value="Cebolla">Cebolla</label>
    </div>

    <button type="submit">Agregar Hamburguesa</button>
  </form>

  <h3>üßæ Pedido Actual</h3>
  <div id="listaPedidos"></div>

  <button id="enviarPedido">Enviar a cocina</button>

  <script>
    const formulario = document.getElementById("formulario");
    const tamano = document.getElementById("tamano");
    const tipo = document.getElementById("tipo");
    const sinIngredientes = document.getElementById("sinIngredientes");
    const todosIngredientes = document.getElementById("todosIngredientes");
    const listaPedidos = document.getElementById("listaPedidos");
    const enviarBtn = document.getElementById("enviarPedido");

    let pedidos = [];

    todosIngredientes.addEventListener("change", () => {
      sinIngredientes.style.display = todosIngredientes.checked ? "none" : "block";
    });

    formulario.addEventListener("submit", (e) => {
      e.preventDefault();

      let sin = [];
      if (!todosIngredientes.checked) {
        sin = Array.from(sinIngredientes.querySelectorAll("input:checked"))
                  .map(i => i.value);
      }

      pedidos.push({
        tamano: tamano.value,
        tipo: tipo.value,
        ingredientes: sin
      });

      mostrarPedidos();
      formulario.reset();
      todosIngredientes.checked = true;
      sinIngredientes.style.display = "none";
    });

    function mostrarPedidos() {
      listaPedidos.innerHTML = "";
      pedidos.forEach((p, i) => {
        const div = document.createElement("div");
        div.classList.add("pedido");
        div.innerHTML = `
          <strong>${p.tamano} - ${p.tipo}</strong><br>
          ${p.ingredientes.length > 0 
            ? `Sin: ${p.ingredientes.join(", ")}`
            : "Con todos los ingredientes"}
          <br><button onclick="editar(${i})">Editar</button>
          <button onclick="eliminar(${i})">Eliminar</button>
        `;
        listaPedidos.appendChild(div);
      });
    }

    function editar(i) {
      const p = pedidos[i];
      tamano.value = p.tamano;
      tipo.value = p.tipo;
      todosIngredientes.checked = p.ingredientes.length === 0;
      sinIngredientes.style.display = todosIngredientes.checked ? "none" : "block";
      sinIngredientes.querySelectorAll("input").forEach(inp => {
        inp.checked = p.ingredientes.includes(inp.value);
      });
      pedidos.splice(i, 1);
      mostrarPedidos();
    }

    function eliminar(i) {
      pedidos.splice(i, 1);
      mostrarPedidos();
    }

    enviarBtn.addEventListener("click", () => {
      if (pedidos.length === 0) {
        alert("No hay pedidos para enviar.");
        return;
      }

      fetch("guardar_pedido.php", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(pedidos)
      })
      .then(r => r.text())
      .then(msg => {
        alert("‚úÖ Pedido enviado a cocina\n" + msg);
        pedidos = [];
        mostrarPedidos();
        formulario.reset();
        todosIngredientes.checked = true;
        sinIngredientes.style.display = "none";
      })
      .catch(err => {
        alert("‚ùå Error al enviar pedido\n" + err);
      });
    });
  </script>

</body>
</html>
