<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pedidos de Hamburguesas</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 500px;
      margin: auto;
    }

    h2 {
      margin-top: 2rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
    }

    .ingrediente {
      margin-right: 0.5rem;
    }

    .pedido {
      border: 1px solid #ccc;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border-radius: 5px;
    }

    button {
      margin-top: 1rem;
      padding: 0.5rem;
      width: 100%;
    }

    .btn-small {
      font-size: 0.8rem;
      margin: 0.25rem;
    }
  </style>
</head>
<body>
  <h1>üçî Tomar Pedido</h1>

  <form id="formulario">
    <h2>Tama√±o</h2>
    <label><input type="radio" name="tamano" value="125 g" /> 125 g</label>
    <label><input type="radio" name="tamano" value="250 g" /> 250 g</label>

    <h2>Tipo</h2>
    <select id="tipo" required>
      <option value="">-- Selecciona una --</option>
      <option value="Tocino">Tocino</option>
      <option value="Guacamole">Guacamole</option>
      <option value="Queso">Queso</option>
      <option value="Chistorra">Chistorra</option>
      <option value="Pi√±a">Pi√±a</option>
      <option value="La T√≥xica">La T√≥xica</option>
    </select>

    <h2>Ingredientes que NO lleva</h2>
    <label><input type="checkbox" id="conTodo" /> Con todo</label>
    <label><input type="checkbox" class="ingrediente" value="Mayonesa" /> Mayonesa</label>
    <label><input type="checkbox" class="ingrediente" value="Catsup" /> Catsup</label>
    <label><input type="checkbox" class="ingrediente" value="Mostaza" /> Mostaza</label>
    <label><input type="checkbox" class="ingrediente" value="Lechuga" /> Lechuga</label>
    <label><input type="checkbox" class="ingrediente" value="Jitomate" /> Jitomate</label>
    <label><input type="checkbox" class="ingrediente" value="Cebolla" /> Cebolla</label>

    <button type="submit">Agregar al pedido</button>
  </form>

  <h2>üßæ Pedido actual</h2>
  <div id="lista-pedidos"></div>

  <button id="enviar">Enviar a cocina</button>

  <script>
    const formulario = document.getElementById("formulario");
    const listaPedidos = document.getElementById("lista-pedidos");
    const enviarBtn = document.getElementById("enviar");
    const conTodoCheckbox = document.getElementById("conTodo");

    let pedidos = [];
    let pedidoEditando = null;

    conTodoCheckbox.addEventListener('change', () => {
      document.querySelectorAll('.ingrediente').forEach(input => {
        input.disabled = conTodoCheckbox.checked;
        if (conTodoCheckbox.checked) input.checked = false;
      });
    });

    formulario.addEventListener('submit', (e) => {
      e.preventDefault();

      const tamano = document.querySelector('input[name="tamano"]:checked');
      const tipo = document.getElementById('tipo').value;
      const noIngredientes = [];
      document.querySelectorAll('.ingrediente').forEach(input => {
        if (input.checked) noIngredientes.push(input.value);
      });

      if (!tamano || !tipo) {
        alert("Por favor selecciona tama√±o y tipo.");
        return;
      }

      const nuevoPedido = {
        tamano: tamano.value,
        tipo,
        ingredientes: conTodoCheckbox.checked ? [] : noIngredientes
      };

      if (pedidoEditando !== null) {
        pedidos[pedidoEditando] = nuevoPedido;
        pedidoEditando = null;
      } else {
        pedidos.push(nuevoPedido);
      }

      mostrarPedidos();
      formulario.reset();
      conTodoCheckbox.checked = false;
      document.querySelectorAll(".ingrediente").forEach(i => i.disabled = false);
    });

    function mostrarPedidos() {
      listaPedidos.innerHTML = "";
      pedidos.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "pedido";
        div.innerHTML = `
          <strong>${p.tamano} - ${p.tipo}</strong><br>
          ${p.ingredientes.length ? `‚ùå No lleva: ${p.ingredientes.join(', ')}` : '‚úÖ Con todo'}<br>
          <button class="btn-small" onclick="editarPedido(${i})">Editar</button>
          <button class="btn-small" onclick="eliminarPedido(${i})">Eliminar</button>
        `;
        listaPedidos.appendChild(div);
      });
    }

    function editarPedido(index) {
      const p = pedidos[index];
      document.querySelector(`input[name="tamano"][value="${p.tamano}"]`).checked = true;
      document.getElementById("tipo").value = p.tipo;
      conTodoCheckbox.checked = p.ingredientes.length === 0;
      document.querySelectorAll(".ingrediente").forEach(input => {
        input.checked = !p.ingredientes.includes(input.value);
        input.disabled = conTodoCheckbox.checked;
      });
      pedidoEditando = index;
    }

    function eliminarPedido(index) {
      pedidos.splice(index, 1);
      mostrarPedidos();
    }

    function enviarAGoogleSheets() {
      const url = "https://script.google.com/macros/s/AKfycbyNq25EanXGUIjfvo2wpd-UigC5kJxIRpAJVyMOrufBuB2DQmamEMQ2ay_f1mLWy_Hv/exec"; // <-- Cambiar URL

      fetch(url, {
        method: "POST",
        body: JSON.stringify({ pedidos }),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(res => res.text())
      .then(msg => {
        console.log("‚úÖ Enviado a Google Sheets:", msg);
      })
      .catch(err => {
        console.error("‚ùå Error al enviar:", err);
      });
    }

    enviarBtn.addEventListener('click', () => {
      if (pedidos.length === 0) {
        alert("No hay pedidos para enviar.");
        return;
      }

      let resumen = "üßæ Pedido a cocina:\n";
      pedidos.forEach((p, i) => {
        resumen += `\nüçî ${i + 1}. ${p.tamano} - ${p.tipo}\n`;
        resumen += `${p.ingredientes.length ? `   ‚ùå No lleva: ${p.ingredientes.join(', ')}` : "   ‚úÖ Con todo"}\n`;
      });

      alert(resumen);
      enviarAGoogleSheets();
      pedidos = [];
      mostrarPedidos();
      formulario.reset();
      conTodoCheckbox.checked = false;
      document.querySelectorAll(".ingrediente").forEach(i => i.disabled = false);
    });
  </script>
</body>
</html>
