<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pedidos</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 600px;
      margin: auto;
    }

    h2 {
      margin-top: 2rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
    }

    .pedido {
      border: 1px solid #ccc;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border-radius: 5px;
    }

    button {
      margin-top: 1rem;
      padding: 1rem;
      width: 100%;
      font-size: 1.1rem;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 8px;
    }

    .btn-small {
      font-size: 0.8rem;
      margin: 0.25rem;
    }
  </style>
</head>
<body>
  <h1>üçî Sistema de Pedidos</h1>

  <form id="formulario">
    <h2>Producto</h2>
    <select id="producto" required>
      <option value="">-- Selecciona --</option>
      <optgroup label="Hamburguesas">
        <option value="Hamburguesa">Hamburguesa</option>
      </optgroup>
      <optgroup label="Hot Dogs">
        <option value="Hot Dog">Hot Dog</option>
      </optgroup>
      <optgroup label="Papas">
        <option value="Papas Francesas">Papas Francesas</option>
        <option value="Papas Gajo">Papas Gajo</option>
        <option value="Shingo Papas Francesas">Shingo Papas Francesas</option>
        <option value="Shingo Papas Gajo">Shingo Papas Gajo</option>
      </optgroup>
      <optgroup label="Bebidas">
        <option value="Refresco">Refresco</option>
        <option value="Malteada">Malteada</option>
        <option value="Soda Italiana">Soda Italiana</option>
        <option value="Cerveza">Cerveza</option>
        <option value="Michelada">Michelada</option>
      </optgroup>
      <optgroup label="Otros">
        <option value="Bites de Queso 6">Bites de Queso (6 piezas)</option>
        <option value="Bites de Queso 10">Bites de Queso (10 piezas)</option>
      </optgroup>
    </select>

    <div id="detalles"></div>

    <button type="submit">Agregar al pedido</button>
  </form>

  <h2>üßæ Pedido actual</h2>
  <div id="lista-pedidos"></div>

  <h3>Total: $<span id="total">0</span></h3>

  <button id="enviar">Enviar a cocina</button>

<!-- Todo el c√≥digo que ya tienes permanece igual hasta el final del script -->
<!-- Reemplaza tu <script> completo con el siguiente -->

<script>
  // ... [todo tu c√≥digo anterior se queda igual hasta mostrarPedidos]

  function mostrarPedidos() {
    listaPedidos.innerHTML = "";
    let suma = 0;
    pedidos.forEach((p, i) => {
      const div = document.createElement("div");
      let txt = `üîπ ${p.prod}`;
      if (p.tipo) txt += ` - ${p.tipo}`;
      if (p.tamano) txt += ` (${p.tamano})`;
      if (p.combo) txt += ` ü•§üçü En combo`;
      if (p.sabor) txt += ` - Sabor: ${p.sabor}`;
      if (p.ingredientes) txt += ` - ${p.ingredientes}`;
      if (p.quesoExtra) txt += ` + Queso extra`;
      if (p.ingredienteExtra && p.ingredienteExtraNombre)
        txt += ` + Extra: ${p.ingredienteExtraNombre}`;
      const precio = calcularPrecio(p);
      suma += precio;
      txt += ` ‚Äî $${precio}`;

      div.className = "pedido";
      div.innerHTML = txt;

      // Botones editar y eliminar
      const editarBtn = document.createElement("button");
      editarBtn.textContent = "‚úèÔ∏è Editar";
      editarBtn.className = "btn-small";
      editarBtn.onclick = () => editarPedido(i);

      const eliminarBtn = document.createElement("button");
      eliminarBtn.textContent = "üóëÔ∏è Eliminar";
      eliminarBtn.className = "btn-small";
      eliminarBtn.onclick = () => {
        pedidos.splice(i, 1);
        mostrarPedidos();
      };

      div.appendChild(editarBtn);
      div.appendChild(eliminarBtn);
      listaPedidos.appendChild(div);
    });
    totalSpan.textContent = suma;
  }

  function editarPedido(i) {
    const p = pedidos[i];
    pedidos.splice(i, 1);
    mostrarPedidos();
    productoSelect.value = p.prod;
    productoSelect.dispatchEvent(new Event("change"));

    setTimeout(() => {
      if (p.prod === "Hamburguesa" || p.prod === "Hot Dog") {
        document.getElementById("tipo").value = p.tipo;
        if (p.ingredientes === "con todo") {
          document.getElementById("conTodo").checked = true;
          document.getElementById("conTodo").dispatchEvent(new Event("change"));
        }
        if (typeof p.ingredientes === "string" && p.ingredientes.startsWith("sin:")) {
          const ings = p.ingredientes.replace("sin: ", "").split(", ");
          document.querySelectorAll(".ingrediente").forEach(chk => {
            if (ings.includes(chk.value)) chk.checked = false;
          });
        }

        document.getElementById("quesoExtra").checked = p.quesoExtra;
        document.getElementById("ingredienteExtra").checked = p.ingredienteExtra;
        if (p.ingredienteExtraNombre) {
          document.getElementById("ingredienteExtra").dispatchEvent(new Event("change"));
          document.getElementById("extraNombre").value = p.ingredienteExtraNombre;
        }

        if (p.prod === "Hamburguesa") {
          document.querySelector(`input[name="tamano"][value="${p.tamano}"]`).checked = true;
          document.getElementById("combo").checked = p.combo;
          document.getElementById("combo").dispatchEvent(new Event("change"));
        }
      } else if (p.prod === "Malteada" || p.prod === "Soda Italiana") {
        document.getElementById("sabor").value = p.sabor;
      } else if (p.prod === "Michelada") {
        p.ingredientes.forEach(val => {
          const chk = [...document.querySelectorAll(".michelada")].find(c => c.value === val);
          if (chk) chk.checked = true;
        });
      }
    }, 100);
  }

  detalles.addEventListener("change", (e) => {
    if (e.target.id === "combo") {
      const comboOpciones = document.getElementById("combo-opciones");
      if (comboOpciones) comboOpciones.style.display = e.target.checked ? "block" : "none";
    }

    if (e.target.id === "conTodo") {
      const ingredientes = document.querySelectorAll(".ingrediente");
      ingredientes.forEach(chk => chk.checked = e.target.checked);
    }

    if (e.target.id === "ingredienteExtra") {
      if (e.target.checked) {
        const selector = `
          <select id="extraNombre">
            <option value="Tocino">Tocino</option>
            <option value="Guacamole">Guacamole</option>
            <option value="Chistorra">Chistorra</option>
            <option value="Pi√±a">Pi√±a</option>
          </select>`;
        e.target.insertAdjacentHTML("afterend", selector);
      } else {
        const extra = document.getElementById("extraNombre");
        if (extra) extra.remove();
      }
    }
  });

  formulario.addEventListener("submit", (e) => {
    e.preventDefault();
    const prod = productoSelect.value;
    let item = { prod };

    if (prod === "Hamburguesa" || prod === "Hot Dog") {
      const tipo = document.getElementById("tipo").value;
      if (!tipo) return alert("Selecciona tipo.");
      item.tipo = tipo;

      const ingrs = Array.from(document.querySelectorAll(".ingrediente"))
        .filter(i => !i.checked)
        .map(i => i.value);
      if (document.getElementById("conTodo").checked) {
        item.ingredientes = "con todo";
      } else if (ingrs.length < ingredientesBase.length) {
        item.ingredientes = `sin: ${ingrs.join(", ")}`;
      }

      item.quesoExtra = document.getElementById("quesoExtra").checked;
      item.ingredienteExtra = document.getElementById("ingredienteExtra").checked;
      if (item.ingredienteExtra) {
        item.ingredienteExtraNombre = document.getElementById("extraNombre")?.value;
      }

      if (prod === "Hamburguesa") {
        const tam = document.querySelector('input[name="tamano"]:checked');
        if (!tam) return alert("Selecciona tama√±o.");
        item.tamano = tam.value;

        const combo = document.getElementById("combo").checked;
        item.combo = combo;
      }
    } else if (prod === "Malteada" || prod === "Soda Italiana") {
      item.sabor = document.getElementById("sabor").value;
    } else if (prod === "Michelada") {
      item.ingredientes = [];
      document.querySelectorAll(".michelada:checked").forEach(i => item.ingredientes.push(i.value));
    }

    pedidos.push(item);
    mostrarPedidos();
    formulario.reset();
    detalles.innerHTML = "";
  });

  enviarBtn.addEventListener("click", () => {
    if (!pedidos.length) return alert("No hay pedidos.");

    const ticketData = pedidos.map(p => {
      const precio = calcularPrecio(p);
      return {
        producto: p.prod,
        tipo: p.tipo || "",
        tamano: p.tamano || "",
        sabor: p.sabor || "",
        ingredientes: p.ingredientes || "",
        combo: p.combo ? "S√≠" : "No",
        quesoExtra: p.quesoExtra ? "S√≠" : "No",
        ingredienteExtra: p.ingredienteExtraNombre || "",
        precio
      };
    });

    const ticketWindow = window.open("ticket.html");
    ticketWindow.onload = () => {
      ticketWindow.postMessage({ pedidos: ticketData }, "*");
    };

    alert("Pedido enviado a cocina.");
    pedidos = [];
    mostrarPedidos();
  });
</script>

</body>
</html>
